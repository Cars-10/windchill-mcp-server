{"ast":null,"code":"import _asyncToGenerator from \"/Users/carstenlawrenz/GIT/KTB3/windchill-mcp-server/angular-ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { HttpHeaders } from '@angular/common/http';\nimport { firstValueFrom } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class McpService {\n  constructor(http) {\n    this.http = http;\n    this.baseUrl = '/api';\n  }\n  /**\n   * Get the list of available tools using MCP JSON-RPC 2.0 protocol\n   */\n  getToolsList() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const request = {\n        jsonrpc: '2.0',\n        id: _this.generateId(),\n        method: 'tools/list',\n        params: {}\n      };\n      try {\n        const response = yield Promise.race([firstValueFrom(_this.http.post(_this.baseUrl, request, {\n          headers: new HttpHeaders({\n            'Content-Type': 'application/json'\n          })\n        })), new Promise((_, reject) => setTimeout(() => reject(new Error('Request timeout')), 5000))]);\n        if (response.error) {\n          throw new Error(`MCP Error ${response.error.code}: ${response.error.message}`);\n        }\n        return response.result;\n      } catch (error) {\n        // Fallback to direct HTTP request if MCP protocol fails\n        console.warn('MCP protocol failed, falling back to direct HTTP:', error.message);\n        return _this.getToolsListDirect();\n      }\n    })();\n  }\n  /**\n   * Fallback method to get tools list via direct HTTP request\n   */\n  getToolsListDirect() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const response = yield Promise.race([firstValueFrom(_this2.http.get(`${_this2.baseUrl}/tools`)), new Promise((_, reject) => setTimeout(() => reject(new Error('Direct request timeout')), 5000))]);\n        return response;\n      } catch (error) {\n        throw new Error(`Failed to load tools: ${error?.message || 'Server unreachable'}`);\n      }\n    })();\n  }\n  /**\n   * Execute a tool using MCP JSON-RPC 2.0 protocol\n   */\n  executeTool(toolName, parameters) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const request = {\n        jsonrpc: '2.0',\n        id: _this3.generateId(),\n        method: 'tools/call',\n        params: {\n          name: toolName,\n          arguments: parameters\n        }\n      };\n      try {\n        const response = yield Promise.race([firstValueFrom(_this3.http.post(_this3.baseUrl, request, {\n          headers: new HttpHeaders({\n            'Content-Type': 'application/json'\n          })\n        })), new Promise((_, reject) => setTimeout(() => reject(new Error('Tool execution timeout')), 15000))]);\n        if (response.error) {\n          throw new Error(`MCP Error ${response.error.code}: ${response.error.message}`);\n        }\n        return response.result;\n      } catch (error) {\n        // Fallback to direct HTTP request if MCP protocol fails\n        console.warn('MCP protocol failed, falling back to direct HTTP:', error.message);\n        return _this3.executeToolDirect(toolName, parameters);\n      }\n    })();\n  }\n  /**\n   * Fallback method to execute tool via direct HTTP request\n   */\n  executeToolDirect(toolName, parameters) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const response = yield Promise.race([firstValueFrom(_this4.http.post(`${_this4.baseUrl}/tools/${toolName}`, parameters, {\n          headers: new HttpHeaders({\n            'Content-Type': 'application/json'\n          })\n        })), new Promise((_, reject) => setTimeout(() => reject(new Error('Tool execution timeout')), 15000))]);\n        return response;\n      } catch (error) {\n        if (error?.status === 404) {\n          throw new Error(`Tool '${toolName}' not found on server`);\n        }\n        if (error?.status === 500) {\n          throw new Error(`Server error executing tool: ${error?.error?.message || error?.message}`);\n        }\n        throw new Error(`Failed to execute tool: ${error?.message || 'Unknown error'}`);\n      }\n    })();\n  }\n  /**\n   * Generate a unique request ID for JSON-RPC\n   */\n  generateId() {\n    return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n  /**\n   * Get server health status\n   */\n  getServerHealth() {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      return firstValueFrom(_this5.http.get(`${_this5.baseUrl}/health`));\n    })();\n  }\n  /**\n   * Get server information\n   */\n  getServerInfo() {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      return firstValueFrom(_this6.http.get(`${_this6.baseUrl}/`));\n    })();\n  }\n  static {\n    this.ɵfac = function McpService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || McpService)(i0.ɵɵinject(i1.HttpClient));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: McpService,\n      factory: McpService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["HttpHeaders","firstValueFrom","McpService","constructor","http","baseUrl","getToolsList","_this","_asyncToGenerator","request","jsonrpc","id","generateId","method","params","response","Promise","race","post","headers","_","reject","setTimeout","Error","error","code","message","result","console","warn","getToolsListDirect","_this2","get","executeTool","toolName","parameters","_this3","name","arguments","executeToolDirect","_this4","status","Date","now","Math","random","toString","substr","getServerHealth","_this5","getServerInfo","_this6","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["/Users/carstenlawrenz/GIT/KTB3/windchill-mcp-server/angular-ui/src/app/services/mcp.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { firstValueFrom } from 'rxjs';\n\nexport interface McpRequest {\n  jsonrpc: '2.0';\n  id: string;\n  method: string;\n  params?: any;\n}\n\nexport interface McpResponse {\n  jsonrpc: '2.0';\n  id: string;\n  result?: any;\n  error?: {\n    code: number;\n    message: string;\n    data?: any;\n  };\n}\n\nexport interface ToolsListResponse {\n  tools: Array<{\n    name: string;\n    description: string;\n    inputSchema: any;\n  }>;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class McpService {\n  private baseUrl = '/api';\n\n  constructor(private http: HttpClient) {}\n\n  /**\n   * Get the list of available tools using MCP JSON-RPC 2.0 protocol\n   */\n  async getToolsList(): Promise<ToolsListResponse> {\n    const request: McpRequest = {\n      jsonrpc: '2.0',\n      id: this.generateId(),\n      method: 'tools/list',\n      params: {}\n    };\n\n    try {\n      const response = await Promise.race([\n        firstValueFrom(\n          this.http.post<McpResponse>(this.baseUrl, request, {\n            headers: new HttpHeaders({\n              'Content-Type': 'application/json'\n            })\n          })\n        ),\n        new Promise((_, reject) =>\n          setTimeout(() => reject(new Error('Request timeout')), 5000)\n        )\n      ]) as McpResponse;\n\n      if (response.error) {\n        throw new Error(`MCP Error ${response.error.code}: ${response.error.message}`);\n      }\n\n      return response.result;\n    } catch (error: any) {\n      // Fallback to direct HTTP request if MCP protocol fails\n      console.warn('MCP protocol failed, falling back to direct HTTP:', error.message);\n      return this.getToolsListDirect();\n    }\n  }\n\n  /**\n   * Fallback method to get tools list via direct HTTP request\n   */\n  private async getToolsListDirect(): Promise<ToolsListResponse> {\n    try {\n      const response = await Promise.race([\n        firstValueFrom(\n          this.http.get<ToolsListResponse>(`${this.baseUrl}/tools`)\n        ),\n        new Promise((_, reject) =>\n          setTimeout(() => reject(new Error('Direct request timeout')), 5000)\n        )\n      ]) as ToolsListResponse;\n\n      return response;\n    } catch (error: any) {\n      throw new Error(`Failed to load tools: ${error?.message || 'Server unreachable'}`);\n    }\n  }\n\n  /**\n   * Execute a tool using MCP JSON-RPC 2.0 protocol\n   */\n  async executeTool(toolName: string, parameters: any): Promise<any> {\n    const request: McpRequest = {\n      jsonrpc: '2.0',\n      id: this.generateId(),\n      method: 'tools/call',\n      params: {\n        name: toolName,\n        arguments: parameters\n      }\n    };\n\n    try {\n      const response = await Promise.race([\n        firstValueFrom(\n          this.http.post<McpResponse>(this.baseUrl, request, {\n            headers: new HttpHeaders({\n              'Content-Type': 'application/json'\n            })\n          })\n        ),\n        new Promise((_, reject) =>\n          setTimeout(() => reject(new Error('Tool execution timeout')), 15000)\n        )\n      ]) as McpResponse;\n\n      if (response.error) {\n        throw new Error(`MCP Error ${response.error.code}: ${response.error.message}`);\n      }\n\n      return response.result;\n    } catch (error: any) {\n      // Fallback to direct HTTP request if MCP protocol fails\n      console.warn('MCP protocol failed, falling back to direct HTTP:', error.message);\n      return this.executeToolDirect(toolName, parameters);\n    }\n  }\n\n  /**\n   * Fallback method to execute tool via direct HTTP request\n   */\n  private async executeToolDirect(toolName: string, parameters: any): Promise<any> {\n    try {\n      const response = await Promise.race([\n        firstValueFrom(\n          this.http.post<any>(`${this.baseUrl}/tools/${toolName}`, parameters, {\n            headers: new HttpHeaders({\n              'Content-Type': 'application/json'\n            })\n          })\n        ),\n        new Promise((_, reject) =>\n          setTimeout(() => reject(new Error('Tool execution timeout')), 15000)\n        )\n      ]) as any;\n\n      return response;\n    } catch (error: any) {\n      if (error?.status === 404) {\n        throw new Error(`Tool '${toolName}' not found on server`);\n      }\n      if (error?.status === 500) {\n        throw new Error(`Server error executing tool: ${error?.error?.message || error?.message}`);\n      }\n      throw new Error(`Failed to execute tool: ${error?.message || 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Generate a unique request ID for JSON-RPC\n   */\n  private generateId(): string {\n    return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Get server health status\n   */\n  async getServerHealth(): Promise<any> {\n    return firstValueFrom(\n      this.http.get(`${this.baseUrl}/health`)\n    );\n  }\n\n  /**\n   * Get server information\n   */\n  async getServerInfo(): Promise<any> {\n    return firstValueFrom(\n      this.http.get(`${this.baseUrl}/`)\n    );\n  }\n}"],"mappings":";AACA,SAAqBA,WAAW,QAAQ,sBAAsB;AAC9D,SAASC,cAAc,QAAQ,MAAM;;;AA+BrC,OAAM,MAAOC,UAAU;EAGrBC,YAAoBC,IAAgB;IAAhB,KAAAA,IAAI,GAAJA,IAAI;IAFhB,KAAAC,OAAO,GAAG,MAAM;EAEe;EAEvC;;;EAGMC,YAAYA,CAAA;IAAA,IAAAC,KAAA;IAAA,OAAAC,iBAAA;MAChB,MAAMC,OAAO,GAAe;QAC1BC,OAAO,EAAE,KAAK;QACdC,EAAE,EAAEJ,KAAI,CAACK,UAAU,EAAE;QACrBC,MAAM,EAAE,YAAY;QACpBC,MAAM,EAAE;OACT;MAED,IAAI;QACF,MAAMC,QAAQ,SAASC,OAAO,CAACC,IAAI,CAAC,CAClChB,cAAc,CACZM,KAAI,CAACH,IAAI,CAACc,IAAI,CAAcX,KAAI,CAACF,OAAO,EAAEI,OAAO,EAAE;UACjDU,OAAO,EAAE,IAAInB,WAAW,CAAC;YACvB,cAAc,EAAE;WACjB;SACF,CAAC,CACH,EACD,IAAIgB,OAAO,CAAC,CAACI,CAAC,EAAEC,MAAM,KACpBC,UAAU,CAAC,MAAMD,MAAM,CAAC,IAAIE,KAAK,CAAC,iBAAiB,CAAC,CAAC,EAAE,IAAI,CAAC,CAC7D,CACF,CAAgB;QAEjB,IAAIR,QAAQ,CAACS,KAAK,EAAE;UAClB,MAAM,IAAID,KAAK,CAAC,aAAaR,QAAQ,CAACS,KAAK,CAACC,IAAI,KAAKV,QAAQ,CAACS,KAAK,CAACE,OAAO,EAAE,CAAC;QAChF;QAEA,OAAOX,QAAQ,CAACY,MAAM;MACxB,CAAC,CAAC,OAAOH,KAAU,EAAE;QACnB;QACAI,OAAO,CAACC,IAAI,CAAC,mDAAmD,EAAEL,KAAK,CAACE,OAAO,CAAC;QAChF,OAAOnB,KAAI,CAACuB,kBAAkB,EAAE;MAClC;IAAC;EACH;EAEA;;;EAGcA,kBAAkBA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAAvB,iBAAA;MAC9B,IAAI;QACF,MAAMO,QAAQ,SAASC,OAAO,CAACC,IAAI,CAAC,CAClChB,cAAc,CACZ8B,MAAI,CAAC3B,IAAI,CAAC4B,GAAG,CAAoB,GAAGD,MAAI,CAAC1B,OAAO,QAAQ,CAAC,CAC1D,EACD,IAAIW,OAAO,CAAC,CAACI,CAAC,EAAEC,MAAM,KACpBC,UAAU,CAAC,MAAMD,MAAM,CAAC,IAAIE,KAAK,CAAC,wBAAwB,CAAC,CAAC,EAAE,IAAI,CAAC,CACpE,CACF,CAAsB;QAEvB,OAAOR,QAAQ;MACjB,CAAC,CAAC,OAAOS,KAAU,EAAE;QACnB,MAAM,IAAID,KAAK,CAAC,yBAAyBC,KAAK,EAAEE,OAAO,IAAI,oBAAoB,EAAE,CAAC;MACpF;IAAC;EACH;EAEA;;;EAGMO,WAAWA,CAACC,QAAgB,EAAEC,UAAe;IAAA,IAAAC,MAAA;IAAA,OAAA5B,iBAAA;MACjD,MAAMC,OAAO,GAAe;QAC1BC,OAAO,EAAE,KAAK;QACdC,EAAE,EAAEyB,MAAI,CAACxB,UAAU,EAAE;QACrBC,MAAM,EAAE,YAAY;QACpBC,MAAM,EAAE;UACNuB,IAAI,EAAEH,QAAQ;UACdI,SAAS,EAAEH;;OAEd;MAED,IAAI;QACF,MAAMpB,QAAQ,SAASC,OAAO,CAACC,IAAI,CAAC,CAClChB,cAAc,CACZmC,MAAI,CAAChC,IAAI,CAACc,IAAI,CAAckB,MAAI,CAAC/B,OAAO,EAAEI,OAAO,EAAE;UACjDU,OAAO,EAAE,IAAInB,WAAW,CAAC;YACvB,cAAc,EAAE;WACjB;SACF,CAAC,CACH,EACD,IAAIgB,OAAO,CAAC,CAACI,CAAC,EAAEC,MAAM,KACpBC,UAAU,CAAC,MAAMD,MAAM,CAAC,IAAIE,KAAK,CAAC,wBAAwB,CAAC,CAAC,EAAE,KAAK,CAAC,CACrE,CACF,CAAgB;QAEjB,IAAIR,QAAQ,CAACS,KAAK,EAAE;UAClB,MAAM,IAAID,KAAK,CAAC,aAAaR,QAAQ,CAACS,KAAK,CAACC,IAAI,KAAKV,QAAQ,CAACS,KAAK,CAACE,OAAO,EAAE,CAAC;QAChF;QAEA,OAAOX,QAAQ,CAACY,MAAM;MACxB,CAAC,CAAC,OAAOH,KAAU,EAAE;QACnB;QACAI,OAAO,CAACC,IAAI,CAAC,mDAAmD,EAAEL,KAAK,CAACE,OAAO,CAAC;QAChF,OAAOU,MAAI,CAACG,iBAAiB,CAACL,QAAQ,EAAEC,UAAU,CAAC;MACrD;IAAC;EACH;EAEA;;;EAGcI,iBAAiBA,CAACL,QAAgB,EAAEC,UAAe;IAAA,IAAAK,MAAA;IAAA,OAAAhC,iBAAA;MAC/D,IAAI;QACF,MAAMO,QAAQ,SAASC,OAAO,CAACC,IAAI,CAAC,CAClChB,cAAc,CACZuC,MAAI,CAACpC,IAAI,CAACc,IAAI,CAAM,GAAGsB,MAAI,CAACnC,OAAO,UAAU6B,QAAQ,EAAE,EAAEC,UAAU,EAAE;UACnEhB,OAAO,EAAE,IAAInB,WAAW,CAAC;YACvB,cAAc,EAAE;WACjB;SACF,CAAC,CACH,EACD,IAAIgB,OAAO,CAAC,CAACI,CAAC,EAAEC,MAAM,KACpBC,UAAU,CAAC,MAAMD,MAAM,CAAC,IAAIE,KAAK,CAAC,wBAAwB,CAAC,CAAC,EAAE,KAAK,CAAC,CACrE,CACF,CAAQ;QAET,OAAOR,QAAQ;MACjB,CAAC,CAAC,OAAOS,KAAU,EAAE;QACnB,IAAIA,KAAK,EAAEiB,MAAM,KAAK,GAAG,EAAE;UACzB,MAAM,IAAIlB,KAAK,CAAC,SAASW,QAAQ,uBAAuB,CAAC;QAC3D;QACA,IAAIV,KAAK,EAAEiB,MAAM,KAAK,GAAG,EAAE;UACzB,MAAM,IAAIlB,KAAK,CAAC,gCAAgCC,KAAK,EAAEA,KAAK,EAAEE,OAAO,IAAIF,KAAK,EAAEE,OAAO,EAAE,CAAC;QAC5F;QACA,MAAM,IAAIH,KAAK,CAAC,2BAA2BC,KAAK,EAAEE,OAAO,IAAI,eAAe,EAAE,CAAC;MACjF;IAAC;EACH;EAEA;;;EAGQd,UAAUA,CAAA;IAChB,OAAO,OAAO8B,IAAI,CAACC,GAAG,EAAE,IAAIC,IAAI,CAACC,MAAM,EAAE,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;EACvE;EAEA;;;EAGMC,eAAeA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAAzC,iBAAA;MACnB,OAAOP,cAAc,CACnBgD,MAAI,CAAC7C,IAAI,CAAC4B,GAAG,CAAC,GAAGiB,MAAI,CAAC5C,OAAO,SAAS,CAAC,CACxC;IAAC;EACJ;EAEA;;;EAGM6C,aAAaA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAA3C,iBAAA;MACjB,OAAOP,cAAc,CACnBkD,MAAI,CAAC/C,IAAI,CAAC4B,GAAG,CAAC,GAAGmB,MAAI,CAAC9C,OAAO,GAAG,CAAC,CAClC;IAAC;EACJ;;;uCA3JWH,UAAU,EAAAkD,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA;IAAA;EAAA;;;aAAVrD,UAAU;MAAAsD,OAAA,EAAVtD,UAAU,CAAAuD,IAAA;MAAAC,UAAA,EAFT;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}